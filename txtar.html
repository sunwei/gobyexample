<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>深入理解Hugo: Txtar</title>
    <link rel=stylesheet href="site.css">
  </head>
  <script>
      onkeydown = (e) => {
          
          if (e.key == "ArrowLeft") {
              window.location.href = 'hello-world';
          }
          
          
      }
  </script>
  <body>
    <div class="example" id="txtar">
      <h2><a href="./">深入理解Hugo</a>: Txtar</h2>
      
      <table>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            <a href="https://go.dev/play/p/UBxifK9AAlD"><img title="Run code" src="play.png" class="run" /></a><img title="Copy code" src="clipboard.png" class="copy" />
          <pre class="chroma"><span class="kn">package</span> <span class="nx">main</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kn">import</span> <span class="p">(</span>
    <span class="s">&#34;bytes&#34;</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;path/filepath&#34;</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="s">&#34;golang.org/x/tools/txtar&#34;</span>
<span class="p">)</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>文件结构
文件名: config.toml
文件内容：theme = &lsquo;mytheme&rsquo;</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="kd">var</span> <span class="nx">files</span> <span class="p">=</span> <span class="s">&#34;-- config.toml --\n&#34;</span> <span class="o">+</span>
    <span class="s">&#34;theme = &#39;mytheme&#39;&#34;</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>解析上面的文件结构</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">data</span> <span class="o">:=</span> <span class="nx">txtar</span><span class="p">.</span><span class="nf">Parse</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">files</span><span class="p">))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;File start:&#34;</span><span class="p">)</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>遍历解析生成的所有文件，通过File结构体获取文件名和文件数据</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
    <span class="c1">//type File struct {
</span></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Name string // name of file (&ldquo;foo/bar.txt&rdquo;)
   Data []byte // text content of file</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
    <span class="c1">//}
</span><span class="c1"></span>    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">f</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Files</span> <span class="p">{</span>
        <span class="nx">filename</span> <span class="o">:=</span> <span class="nx">filepath</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="s">&#34;workingDir&#34;</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
        <span class="nx">data</span> <span class="o">:=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">TrimSuffix</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">Data</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;\n&#34;</span><span class="p">))</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code">
            
          <pre class="chroma">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;File end.&#34;</span><span class="p">)</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
      </table>
      
      <table>
        
        <tr>
          <td class="docs">
            <p>解析后得到文件config.toml，以及下面的文件内容
workingDir就是我们的工作目录，通常是要写入的文件目录</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="go">File start:
</span><span class="go">workingDir/config.toml
</span><span class="go">theme = &#39;mytheme&#39;
</span><span class="go">File end.</span></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code">
            
          <pre class="chroma"><span class="go">Program exited.</span></pre>
          </td>
        </tr>
        
      </table>
      
      

    <p class="footer">
      by <a href="https://sunwei.xyz">孙伟</a>
      | <a href="https://github.com/sunwei/gobyexample">source</a>
      | <a href="https://github.com/sunwei/gobyexample#license">license</a>
      | Inspired by <a href="https://github.com/mmcgrana/gobyexample">gobyexample.com</a>
      | Build with LOVE 💞
    </p>

    </div>
    <script>
      var codeLines = [];
      codeLines.push('package main\u000A');codeLines.push('import (\u000A    \"bytes\"\u000A    \"fmt\"\u000A    \"path/filepath\"\u000A');codeLines.push('    \"golang.org/x/tools/txtar\"\u000A)\u000A');codeLines.push('var files \u003D \"-- config.toml --\\n\" +\u000A    \"theme \u003D \'mytheme\'\"\u000A');codeLines.push('func main() {\u000A');codeLines.push('    data :\u003D txtar.Parse([]byte(files))\u000A    fmt.Println(\"File start:\")\u000A');codeLines.push('    //type File struct {\u000A');codeLines.push('    //}\u000A    for _, f :\u003D range data.Files {\u000A        filename :\u003D filepath.Join(\"workingDir\", f.Name)\u000A        data :\u003D bytes.TrimSuffix(f.Data, []byte(\"\\n\"))\u000A');codeLines.push('        fmt.Println(filename)\u000A        fmt.Println(string(data))\u000A    }\u000A    fmt.Println(\"File end.\")\u000A}\u000A');codeLines.push('');codeLines.push('');
    </script>
    <script src="site.js" async></script>
  </body>
</html>
