<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>深入理解Hugo: Collect Module</title>
    <link rel=stylesheet href="site.css">
  </head>
  <script>
      onkeydown = (e) => {
          
          if (e.key == "ArrowLeft") {
              window.location.href = 'config-provider';
          }
          
          
      }
  </script>
  <body>
    <div class="example" id="collect-module">
      <h2><a href="./">深入理解Hugo</a>: Collect Module</h2>
      
      <table>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            <a href="https://go.dev/play/p/Yzwfn7C3s79"><img title="Run code" src="play.png" class="run" /></a><img title="Copy code" src="clipboard.png" class="copy" />
          <pre class="chroma"><span class="kn">package</span> <span class="nx">main</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>relative path in source repo, e.g. &ldquo;scss&rdquo;</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">type</span> <span class="nx">Mount</span> <span class="kd">struct</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>relative target path, e.g. &ldquo;assets/bootstrap/scss&rdquo;</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">Source</span> <span class="kt">string</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>any language code associated with this mount.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">Target</span> <span class="kt">string</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">Lang</span> <span class="kt">string</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Module path</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">type</span> <span class="nx">Import</span> <span class="kd">struct</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">Path</span> <span class="kt">string</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Config holds a module config.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="kd">type</span> <span class="nx">Config</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Mounts</span>  <span class="p">[]</span><span class="nx">Mount</span>
    <span class="nx">Imports</span> <span class="p">[]</span><span class="nx">Import</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Config The decoded module config and mounts.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">type</span> <span class="nx">Module</span> <span class="kd">interface</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Owner In the dependency tree, this is the first module that defines this module
as a dependency.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nf">Config</span><span class="p">()</span> <span class="nx">Config</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Mounts Any directory remappings.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nf">Owner</span><span class="p">()</span> <span class="nx">Module</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nf">Mounts</span><span class="p">()</span> <span class="p">[]</span><span class="nx">Mount</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">type</span> <span class="nx">Modules</span> <span class="p">[]</span><span class="nx">Module</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">var</span> <span class="nx">modules</span> <span class="nx">Modules</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>moduleAdapter implemented Module interface</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="kd">type</span> <span class="nx">moduleAdapter</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">projectMod</span> <span class="kt">bool</span>
    <span class="nx">owner</span>      <span class="nx">Module</span>
    <span class="nx">mounts</span>     <span class="p">[]</span><span class="nx">Mount</span>
    <span class="nx">config</span>     <span class="nx">Config</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">moduleAdapter</span><span class="p">)</span> <span class="nf">Config</span><span class="p">()</span> <span class="nx">Config</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">config</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">moduleAdapter</span><span class="p">)</span> <span class="nf">Mounts</span><span class="p">()</span> <span class="p">[]</span><span class="nx">Mount</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">mounts</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">moduleAdapter</span><span class="p">)</span> <span class="nf">Owner</span><span class="p">()</span> <span class="nx">Module</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">owner</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>happy path to easily understand</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>project module config</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
    <span class="nx">moduleConfig</span> <span class="o">:=</span> <span class="nx">Config</span><span class="p">{}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">imports</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;mytheme&#34;</span><span class="p">}</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">imp</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">imports</span> <span class="p">{</span>
        <span class="nx">moduleConfig</span><span class="p">.</span><span class="nx">Imports</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span>
            <span class="nx">moduleConfig</span><span class="p">.</span><span class="nx">Imports</span><span class="p">,</span> <span class="nx">Import</span><span class="p">{</span>
                <span class="nx">Path</span><span class="p">:</span> <span class="nx">imp</span><span class="p">,</span>
            <span class="p">})</span>
    <span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Need to run these after the modules are loaded, but before
they are finalized.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
    <span class="nx">collectHook</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">mods</span> <span class="nx">Modules</span><span class="p">)</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Apply default project mounts.
Default folder structure for hugo project</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
        <span class="nf">ApplyProjectConfigDefaults</span><span class="p">(</span><span class="nx">mods</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nf">collectModules</span><span class="p">(</span><span class="nx">moduleConfig</span><span class="p">,</span> <span class="nx">collectHook</span><span class="p">)</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">m</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">modules</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%#v\n&#34;</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Module folder structure</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">ComponentFolderArchetypes</span> <span class="p">=</span> <span class="s">&#34;archetypes&#34;</span>
    <span class="nx">ComponentFolderStatic</span>     <span class="p">=</span> <span class="s">&#34;static&#34;</span>
    <span class="nx">ComponentFolderLayouts</span>    <span class="p">=</span> <span class="s">&#34;layouts&#34;</span>
    <span class="nx">ComponentFolderContent</span>    <span class="p">=</span> <span class="s">&#34;content&#34;</span>
    <span class="nx">ComponentFolderData</span>       <span class="p">=</span> <span class="s">&#34;data&#34;</span>
    <span class="nx">ComponentFolderAssets</span>     <span class="p">=</span> <span class="s">&#34;assets&#34;</span>
    <span class="nx">ComponentFolderI18n</span>       <span class="p">=</span> <span class="s">&#34;i18n&#34;</span>
<span class="p">)</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>ApplyProjectConfigDefaults applies default/missing module configuration for
the main project.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="kd">func</span> <span class="nf">ApplyProjectConfigDefaults</span><span class="p">(</span><span class="nx">mod</span> <span class="nx">Module</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">projectMod</span> <span class="o">:=</span> <span class="nx">mod</span><span class="p">.(</span><span class="o">*</span><span class="nx">moduleAdapter</span><span class="p">)</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="kd">type</span> <span class="nx">dirKeyComponent</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">key</span>          <span class="kt">string</span>
        <span class="nx">component</span>    <span class="kt">string</span>
        <span class="nx">multilingual</span> <span class="kt">bool</span>
    <span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">dirKeys</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">dirKeyComponent</span><span class="p">{</span>
        <span class="p">{</span><span class="s">&#34;contentDir&#34;</span><span class="p">,</span> <span class="nx">ComponentFolderContent</span><span class="p">,</span> <span class="kc">true</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;dataDir&#34;</span><span class="p">,</span> <span class="nx">ComponentFolderData</span><span class="p">,</span> <span class="kc">false</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;layoutDir&#34;</span><span class="p">,</span> <span class="nx">ComponentFolderLayouts</span><span class="p">,</span> <span class="kc">false</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;i18nDir&#34;</span><span class="p">,</span> <span class="nx">ComponentFolderI18n</span><span class="p">,</span> <span class="kc">false</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;archetypeDir&#34;</span><span class="p">,</span> <span class="nx">ComponentFolderArchetypes</span><span class="p">,</span>
            <span class="kc">false</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;assetDir&#34;</span><span class="p">,</span> <span class="nx">ComponentFolderAssets</span><span class="p">,</span> <span class="kc">false</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">ComponentFolderStatic</span><span class="p">,</span> <span class="kc">false</span><span class="p">},</span>
    <span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>based on language content configuration
multiple language has multiple source folders</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="kd">var</span> <span class="nx">mounts</span> <span class="p">[]</span><span class="nx">Mount</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">d</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">dirKeys</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">d</span><span class="p">.</span><span class="nx">multilingual</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">            <span class="k">if</span> <span class="nx">d</span><span class="p">.</span><span class="nx">component</span> <span class="o">==</span> <span class="nx">ComponentFolderContent</span> <span class="p">{</span>
                <span class="nx">mounts</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">mounts</span><span class="p">,</span> <span class="nx">Mount</span><span class="p">{</span>
                    <span class="nx">Lang</span><span class="p">:</span>   <span class="s">&#34;en&#34;</span><span class="p">,</span>
                    <span class="nx">Source</span><span class="p">:</span> <span class="s">&#34;mycontent&#34;</span><span class="p">,</span>
                    <span class="nx">Target</span><span class="p">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">component</span><span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">mounts</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">mounts</span><span class="p">,</span>
                <span class="nx">Mount</span><span class="p">{</span>
                    <span class="nx">Source</span><span class="p">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">component</span><span class="p">,</span>
                    <span class="nx">Target</span><span class="p">:</span> <span class="nx">d</span><span class="p">.</span><span class="nx">component</span><span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">projectMod</span><span class="p">.</span><span class="nx">mounts</span> <span class="p">=</span> <span class="nx">mounts</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">func</span> <span class="nf">collectModules</span><span class="p">(</span><span class="nx">modConfig</span> <span class="nx">Config</span><span class="p">,</span>
    <span class="nx">hookBeforeFinalize</span> <span class="kd">func</span><span class="p">(</span><span class="nx">m</span> <span class="nx">Modules</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">projectMod</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">moduleAdapter</span><span class="p">{</span>
        <span class="nx">projectMod</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">config</span><span class="p">:</span>     <span class="nx">modConfig</span><span class="p">,</span>
    <span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>module structure, [project, others&hellip;]</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
    <span class="nf">addAndRecurse</span><span class="p">(</span><span class="nx">projectMod</span><span class="p">)</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Add the project mod on top.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
    <span class="nx">modules</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">Modules</span><span class="p">{</span><span class="nx">projectMod</span><span class="p">},</span> <span class="nx">modules</span><span class="o">...</span><span class="p">)</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="k">if</span> <span class="nx">hookBeforeFinalize</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nf">hookBeforeFinalize</span><span class="p">(</span><span class="nx">modules</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>addAndRecurse Project Imports -&gt; Import imports</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="kd">func</span> <span class="nf">addAndRecurse</span><span class="p">(</span><span class="nx">owner</span> <span class="o">*</span><span class="nx">moduleAdapter</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">moduleConfig</span> <span class="o">:=</span> <span class="nx">owner</span><span class="p">.</span><span class="nf">Config</span><span class="p">()</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>theme may depend on other theme</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">moduleImport</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">moduleConfig</span><span class="p">.</span><span class="nx">Imports</span> <span class="p">{</span>
        <span class="nx">tc</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span> <span class="nx">moduleImport</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">tc</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">continue</span>
        <span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>tc is mytheme with no config file</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
        <span class="nf">addAndRecurse</span><span class="p">(</span><span class="nx">tc</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><span class="kd">func</span> <span class="nf">add</span><span class="p">(</span><span class="nx">owner</span> <span class="o">*</span><span class="nx">moduleAdapter</span><span class="p">,</span>
    <span class="nx">moduleImport</span> <span class="nx">Import</span><span class="p">)</span> <span class="o">*</span><span class="nx">moduleAdapter</span> <span class="p">{</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>in the example, mytheme has no other import</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;start to create `%s` module\n&#34;</span><span class="p">,</span>
        <span class="nx">moduleImport</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
    <span class="nx">ma</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">moduleAdapter</span><span class="p">{</span>
        <span class="nx">owner</span><span class="p">:</span> <span class="nx">owner</span><span class="p">,</span>
</pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code">
            
          <pre class="chroma">        <span class="nx">config</span><span class="p">:</span> <span class="nx">Config</span><span class="p">{},</span>
    <span class="p">}</span>
    <span class="nx">modules</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">modules</span><span class="p">,</span> <span class="nx">ma</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">ma</span>
<span class="p">}</span>
</pre>
          </td>
        </tr>
        
      </table>
      
      <table>
        
        <tr>
          <td class="docs">
            <p>collect theme as module</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="go">start to create `mytheme` module</span></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>project module has no owner with default mounts</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="go">&amp;main.moduleAdapter{
</span><span class="go">  projectMod:true, owner:main.Module(nil),
</span><span class="go">  mounts:[]main.Mount{
</span><span class="go">    main.Mount{
</span><span class="go">      Source:&#34;mycontent&#34;, Target:&#34;content&#34;,Lang:&#34;en&#34;},
</span><span class="go">    main.Mount{Source:&#34;data&#34;, Target:&#34;data&#34;, Lang:&#34;&#34;},
</span><span class="go">    main.Mount{
</span><span class="go">      Source:&#34;layouts&#34;, Target:&#34;layouts&#34;, Lang:&#34;&#34;},
</span><span class="go">    main.Mount{Source:&#34;i18n&#34;, Target:&#34;i18n&#34;, Lang:&#34;&#34;},
</span><span class="go">    main.Mount{
</span><span class="go">      Source:&#34;archetypes&#34;, Target:&#34;archetypes&#34;, Lang:&#34;&#34;},
</span><span class="go">    main.Mount{Source:&#34;assets&#34;, Target:&#34;assets&#34;, Lang:&#34;&#34;},
</span><span class="go">    main.Mount{
</span><span class="go">      Source:&#34;static&#34;, Target:&#34;static&#34;, Lang:&#34;&#34;}},
</span><span class="go">    config:main.Config{Mounts:[]main.Mount(nil),
</span><span class="go">    Imports:[]main.Import{main.Import{Path:&#34;mytheme&#34;}}}}</span></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>theme module owned by project module
with no import in the example</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma">
<span class="go">&amp;main.moduleAdapter{projectMod:false,
</span><span class="go">owner:(*main.moduleAdapter)(0xc000102120),
</span><span class="go">mounts:[]main.Mount(nil),
</span><span class="go">config:main.Config{
</span><span class="go">  Mounts:[]main.Mount(nil), Imports:[]main.Import(nil)}}</span></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code">
            
          <pre class="chroma"><span class="go">Program exited.</span></pre>
          </td>
        </tr>
        
      </table>
      
      

    <p class="footer">
      by <a href="https://sunwei.xyz">孙伟</a>
      | <a href="https://github.com/sunwei/gobyexample">source</a>
      | <a href="https://github.com/sunwei/gobyexample#license">license</a>
      | Inspired by <a href="https://github.com/mmcgrana/gobyexample">gobyexample.com</a>
      | Build with LOVE 💞
    </p>

    </div>
    <script>
      var codeLines = [];
      codeLines.push('package main\u000A');codeLines.push('import \"fmt\"\u000A');codeLines.push('type Mount struct {\u000A');codeLines.push('    Source string\u000A');codeLines.push('    Target string\u000A');codeLines.push('    Lang string\u000A}\u000A');codeLines.push('type Import struct {\u000A');codeLines.push('    Path string\u000A}\u000A');codeLines.push('type Config struct {\u000A    Mounts  []Mount\u000A    Imports []Import\u000A}\u000A');codeLines.push('type Module interface {\u000A');codeLines.push('    Config() Config\u000A');codeLines.push('    Owner() Module\u000A');codeLines.push('    Mounts() []Mount\u000A}\u000A');codeLines.push('type Modules []Module\u000A');codeLines.push('var modules Modules\u000A');codeLines.push('type moduleAdapter struct {\u000A    projectMod bool\u000A    owner      Module\u000A    mounts     []Mount\u000A    config     Config\u000A}\u000A');codeLines.push('func (m *moduleAdapter) Config() Config {\u000A    return m.config\u000A}\u000Afunc (m *moduleAdapter) Mounts() []Mount {\u000A    return m.mounts\u000A}\u000Afunc (m *moduleAdapter) Owner() Module {\u000A    return m.owner\u000A}\u000A');codeLines.push('func main() {\u000A');codeLines.push('    moduleConfig :\u003D Config{}\u000A');codeLines.push('    imports :\u003D []string{\"mytheme\"}\u000A    for _, imp :\u003D range imports {\u000A        moduleConfig.Imports \u003D append(\u000A            moduleConfig.Imports, Import{\u000A                Path: imp,\u000A            })\u000A    }\u000A');codeLines.push('    collectHook :\u003D func(mods Modules) {\u000A');codeLines.push('        ApplyProjectConfigDefaults(mods[0])\u000A    }\u000A');codeLines.push('    collectModules(moduleConfig, collectHook)\u000A');codeLines.push('    for _, m :\u003D range modules {\u000A        fmt.Printf(\"%#v\\n\", m)\u000A    }\u000A}\u000A');codeLines.push('const (\u000A    ComponentFolderArchetypes \u003D \"archetypes\"\u000A    ComponentFolderStatic     \u003D \"static\"\u000A    ComponentFolderLayouts    \u003D \"layouts\"\u000A    ComponentFolderContent    \u003D \"content\"\u000A    ComponentFolderData       \u003D \"data\"\u000A    ComponentFolderAssets     \u003D \"assets\"\u000A    ComponentFolderI18n       \u003D \"i18n\"\u000A)\u000A');codeLines.push('func ApplyProjectConfigDefaults(mod Module) {\u000A    projectMod :\u003D mod.(*moduleAdapter)\u000A');codeLines.push('    type dirKeyComponent struct {\u000A        key          string\u000A        component    string\u000A        multilingual bool\u000A    }\u000A');codeLines.push('    dirKeys :\u003D []dirKeyComponent{\u000A        {\"contentDir\", ComponentFolderContent, true},\u000A        {\"dataDir\", ComponentFolderData, false},\u000A        {\"layoutDir\", ComponentFolderLayouts, false},\u000A        {\"i18nDir\", ComponentFolderI18n, false},\u000A        {\"archetypeDir\", ComponentFolderArchetypes,\u000A            false},\u000A        {\"assetDir\", ComponentFolderAssets, false},\u000A        {\"\", ComponentFolderStatic, false},\u000A    }\u000A');codeLines.push('    var mounts []Mount\u000A    for _, d :\u003D range dirKeys {\u000A        if d.multilingual {\u000A');codeLines.push('            if d.component \u003D\u003D ComponentFolderContent {\u000A                mounts \u003D append(mounts, Mount{\u000A                    Lang:   \"en\",\u000A                    Source: \"mycontent\",\u000A                    Target: d.component})\u000A            }\u000A        } else {\u000A            mounts \u003D append(mounts,\u000A                Mount{\u000A                    Source: d.component,\u000A                    Target: d.component})\u000A        }\u000A    }\u000A');codeLines.push('    projectMod.mounts \u003D mounts\u000A}\u000A');codeLines.push('func collectModules(modConfig Config,\u000A    hookBeforeFinalize func(m Modules)) {\u000A    projectMod :\u003D \u0026moduleAdapter{\u000A        projectMod: true,\u000A        config:     modConfig,\u000A    }\u000A');codeLines.push('    addAndRecurse(projectMod)\u000A');codeLines.push('    modules \u003D append(Modules{projectMod}, modules...)\u000A');codeLines.push('    if hookBeforeFinalize !\u003D nil {\u000A        hookBeforeFinalize(modules)\u000A    }\u000A}\u000A');codeLines.push('func addAndRecurse(owner *moduleAdapter) {\u000A    moduleConfig :\u003D owner.Config()\u000A');codeLines.push('    for _, moduleImport :\u003D range moduleConfig.Imports {\u000A        tc :\u003D add(owner, moduleImport)\u000A        if tc \u003D\u003D nil {\u000A            continue\u000A        }\u000A');codeLines.push('        addAndRecurse(tc)\u000A    }\u000A}\u000A');codeLines.push('func add(owner *moduleAdapter,\u000A    moduleImport Import) *moduleAdapter {\u000A');codeLines.push('    fmt.Printf(\"start to create `%s` module\\n\",\u000A        moduleImport.Path)\u000A    ma :\u003D \u0026moduleAdapter{\u000A        owner: owner,\u000A');codeLines.push('        config: Config{},\u000A    }\u000A    modules \u003D append(modules, ma)\u000A    return ma\u000A}\u000A');codeLines.push('');codeLines.push('');codeLines.push('');codeLines.push('');
    </script>
    <script src="site.js" async></script>
  </body>
</html>
